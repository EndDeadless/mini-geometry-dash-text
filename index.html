<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GD Mini — Menu</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="menu">
    <h1>Geometry Dash — Mini (Pro)</h1>

    <div class="row">
      <label>Tên:</label>
      <input id="playerName" placeholder="Nhập tên (tối đa 12 ký tự)" maxlength="12" />
      <button id="saveName">Lưu</button>
    </div>

    <div class="levels">
      <button class="levelBtn" data-level="1">▶ Level 1 — Easy</button>
      <button class="levelBtn" data-level="2">▶ Level 2 — Spike Hell</button>
      <button class="levelBtn" data-level="3">▶ Level 3 — Ultra Dash</button>
    </div>

    <div class="info">
      <div id="bestAll">Best tổng: 0</div>
      <div id="progress">Màn mở: 1</div>
    </div>

    <small class="muted">Lưu tiến trình & best trên trình duyệt. Muốn sync cloud thì nói tớ.</small>
  </div>

  <script>
    // load/save name + progress
    const nameInput = document.getElementById('playerName');
    const saveBtn = document.getElementById('saveName');
    const bestAll = document.getElementById('bestAll');
    const progress = document.getElementById('progress');

    const SAVE_KEY = 'gd_mini_save_v1';
    let save = JSON.parse(localStorage.getItem(SAVE_KEY) || '{}');
    if(!save.unlocked) { save.unlocked = [1]; save.best = {}; localStorage.setItem(SAVE_KEY, JSON.stringify(save)); }

    // name
    const savedName = localStorage.getItem('gd_mini_name') || '';
    nameInput.value = savedName;
    saveBtn.addEventListener('click', ()=> {
      const v = nameInput.value.trim().slice(0,12);
      localStorage.setItem('gd_mini_name', v);
      alert('Đã lưu tên: ' + (v || 'Player'));
    });

    // render progress & best
    function renderStatus(){
      const unlocked = save.unlocked || [1];
      progress.textContent = 'Màn mở: ' + unlocked.join(', ');
      const bestVals = Object.values(save.best || {});
      bestAll.textContent = 'Best tổng: ' + (bestVals.length ? Math.max(...bestVals) : 0);
    }
    renderStatus();

    // level buttons
    document.querySelectorAll('.levelBtn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const level = btn.dataset.level;
        // check locked
        const id = parseInt(level,10);
        if(!save.unlocked.includes(id)){
          alert('Màn chưa mở. Chơi màn trước để mở khóa.');
          return;
        }
        // open levelX.html
        window.location.href = `level${id}.html`;
      });
    });
  </script>
</body>
</html>
